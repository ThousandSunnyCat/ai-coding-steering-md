{
  "enabled": true,
  "name": "dependency-security-check",
  "description": "æ£€æŸ¥é¡¹ç›®ä¾èµ–ä¸­çš„å®‰å…¨æ¼æ´å’Œæ•æ„Ÿé…ç½®",
  "version": "1",
  "when": {
    "type": "fileSaved",
    "filePattern": "{package.json,requirements.txt,go.mod,Cargo.toml,composer.json,pom.xml}"
  },
  "then": {
    "type": "askAgent",
    "prompt": "ç›‘æ§é¡¹ç›®ä¾èµ–æ–‡ä»¶çš„å˜æ›´ï¼ŒåŠæ—¶å‘ç°å®‰å…¨é£é™©å’Œé…ç½®é—®é¢˜ï¼š\n\n## 1. ä¾èµ–æ–‡ä»¶ç±»å‹è¯†åˆ«\n\n**æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š**\n- `package.json` - Node.js é¡¹ç›®\n- `requirements.txt` - Python é¡¹ç›®  \n- `go.mod` - Go é¡¹ç›®\n- `Cargo.toml` - Rust é¡¹ç›®\n- `composer.json` - PHP é¡¹ç›®\n- `pom.xml` - Java Maven é¡¹ç›®\n\n## 2. å·²çŸ¥é«˜é£é™©ä¾èµ–æ£€æŸ¥\n\n**Node.js é«˜é£é™©åŒ…ï¼š**\n```json\n{\n  \"é«˜é£é™©\": [\n    \"event-stream\",     // æ›¾è¢«æ¤å…¥æ¶æ„ä»£ç \n    \"flatmap-stream\",   // æ¶æ„åŒ…\n    \"eslint-scope\",     // æ›¾è¢«åŠ«æŒ\n    \"getcookies\"        // æ¶æ„åŒ…\n  ],\n  \"éœ€è¦æ³¨æ„\": [\n    \"lodash\",          // ç‰ˆæœ¬ < 4.17.12 æœ‰åŸå‹æ±¡æŸ“æ¼æ´\n    \"axios\",           // ç‰ˆæœ¬ < 0.21.1 æœ‰ SSRF æ¼æ´\n    \"express\",         // éœ€è¦é…ç½®å®‰å…¨ä¸­é—´ä»¶\n    \"jsonwebtoken\"     // éœ€è¦æ­£ç¡®é…ç½®ç®—æ³•\n  ]\n}\n```\n\n**Python é«˜é£é™©åŒ…ï¼š**\n```python\nHIGH_RISK_PACKAGES = [\n    \"urllib3\",         # ç‰ˆæœ¬ < 1.26.5 æœ‰å®‰å…¨é—®é¢˜\n    \"requests\",        # ç‰ˆæœ¬ < 2.25.1 æœ‰è¯ä¹¦éªŒè¯é—®é¢˜  \n    \"pyyaml\",          # ç‰ˆæœ¬ < 5.4 æœ‰ä»£ç æ‰§è¡Œæ¼æ´\n    \"pillow\",          # éœ€è¦å…³æ³¨å›¾åƒå¤„ç†æ¼æ´\n    \"django\",          # éœ€è¦æ­£ç¡®é…ç½®å®‰å…¨è®¾ç½®\n    \"flask\"            # éœ€è¦é…ç½®å®‰å…¨å¤´\n]\n```\n\n## 3. ç‰ˆæœ¬å®‰å…¨æ£€æŸ¥\n\n**è¿‡æ—¶ç‰ˆæœ¬è­¦å‘Šï¼š**\n```bash\n# æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†å·²çŸ¥æœ‰æ¼æ´çš„ç‰ˆæœ¬\nif package == \"lodash\" && version < \"4.17.21\":\n    warn(\"lodash ç‰ˆæœ¬è¿‡ä½ï¼Œå­˜åœ¨åŸå‹æ±¡æŸ“æ¼æ´\")\n\nif package == \"axios\" && version < \"0.21.2\":\n    warn(\"axios ç‰ˆæœ¬å­˜åœ¨ SSRF æ¼æ´\")\n```\n\n**å»ºè®®çš„å®‰å…¨ç‰ˆæœ¬ï¼š**\n- æä¾›å½“å‰ç¨³å®šç‰ˆæœ¬ä¿¡æ¯\n- æ ‡æ³¨é‡è¦çš„å®‰å…¨æ›´æ–°ç‰ˆæœ¬\n- ç»™å‡ºå‡çº§å‘½ä»¤\n\n## 4. é…ç½®å®‰å…¨æ£€æŸ¥\n\n**package.json å®‰å…¨é…ç½®ï¼š**\n```json\n{\n  \"scripts\": {\n    \"start\": \"node server.js\",  // âŒ ç”Ÿäº§ç¯å¢ƒä¸åº”æš´éœ²æºç è·¯å¾„\n    \"dev\": \"nodemon app.js\"     // âœ… å¼€å‘è„šæœ¬\n  },\n  \"engines\": {\n    \"node\": \">=14.0.0\"          // âœ… æŒ‡å®šæœ€ä½å®‰å…¨ç‰ˆæœ¬\n  }\n}\n```\n\n**requirements.txt å®‰å…¨é…ç½®ï¼š**\n```txt\n# âŒ ä¸å›ºå®šç‰ˆæœ¬ï¼Œå­˜åœ¨ä¾›åº”é“¾é£é™©\nrequests\n\n# âœ… å›ºå®šå®‰å…¨ç‰ˆæœ¬\nrequests==2.28.1\n\n# âœ… ä½¿ç”¨å“ˆå¸ŒéªŒè¯\nrequests==2.28.1 --hash=sha256:...\n```\n\n## 5. ä¾›åº”é“¾å®‰å…¨æ£€æŸ¥\n\n**å¯ç–‘ä¾èµ–æ¨¡å¼ï¼š**\n- åŒ…åä¸çŸ¥ååŒ…ç›¸ä¼¼ï¼ˆtyposquattingï¼‰\n- ç‰ˆæœ¬å·å¼‚å¸¸ï¼ˆå¦‚ 999.999.999ï¼‰\n- ä½œè€…ä¿¡æ¯ç¼ºå¤±æˆ–å¯ç–‘\n- æœ€è¿‘æ›´æ–°æ—¶é—´å¼‚å¸¸\n\n**æ£€æŸ¥é€»è¾‘ï¼š**\n```javascript\n// æ£€æŸ¥åŒ…åç›¸ä¼¼æ€§\nconst suspiciousNames = [\n  \"reqeusts\",    // requests çš„æ‹¼å†™é”™è¯¯\n  \"urlib3\",      // urllib3 çš„æ‹¼å†™é”™è¯¯\n  \"beutifulsoup\" // beautifulsoup çš„æ‹¼å†™é”™è¯¯\n];\n```\n\n## 6. è‡ªåŠ¨å®‰å…¨æ‰«æå»ºè®®\n\n**Node.js é¡¹ç›®ï¼š**\n```bash\n# ä½¿ç”¨ npm audit æ£€æŸ¥æ¼æ´\nnpm audit\nnpm audit fix\n\n# ä½¿ç”¨ Snyk è¿›è¡Œæ·±åº¦æ‰«æ\nnpx snyk test\n```\n\n**Python é¡¹ç›®ï¼š**\n```bash\n# ä½¿ç”¨ safety æ£€æŸ¥å·²çŸ¥æ¼æ´\npip install safety\nsafety check\n\n# ä½¿ç”¨ bandit è¿›è¡Œä»£ç å®‰å…¨æ‰«æ\npip install bandit\nbandit -r .\n```\n\n## 7. è¾“å‡ºæ ¼å¼\n\n**å‘ç°å®‰å…¨é—®é¢˜ï¼š**\n```\nğŸ” ä¾èµ–å®‰å…¨æ‰«ææŠ¥å‘Š\nğŸ“ æ–‡ä»¶ï¼špackage.json\n\nğŸš¨ é«˜é£é™©ä¾èµ–ï¼š\n- lodash@4.17.10 â†’ å­˜åœ¨åŸå‹æ±¡æŸ“æ¼æ´\n  ğŸ”§ ä¿®å¤ï¼šnpm install lodash@^4.17.21\n\nâš ï¸  ä¸­é£é™©ä¾èµ–ï¼š\n- axios@0.20.0 â†’ ç‰ˆæœ¬è¾ƒæ—§ï¼Œå»ºè®®å‡çº§\n  ğŸ”§ ä¿®å¤ï¼šnpm install axios@^0.27.0\n\nğŸ’¡ å»ºè®®ï¼š\n- è¿è¡Œ `npm audit` è¿›è¡Œå®Œæ•´å®‰å…¨æ£€æŸ¥\n- è€ƒè™‘ä½¿ç”¨ `npm audit fix` è‡ªåŠ¨ä¿®å¤\n- å®šæœŸæ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç¨³å®šç‰ˆæœ¬\n```\n\n**å®‰å…¨é€šè¿‡ï¼š**\n```\nâœ… ä¾èµ–å®‰å…¨æ£€æŸ¥é€šè¿‡\nğŸ“Š æ‰«æäº† 25 ä¸ªä¾èµ–åŒ…\nğŸ”’ æœªå‘ç°å·²çŸ¥å®‰å…¨æ¼æ´\nğŸ’¡ å»ºè®®å®šæœŸè¿è¡Œ npm audit ä¿æŒå®‰å…¨\n```\n\nè¯·ç«‹å³æ£€æŸ¥åˆšä¿å­˜çš„ä¾èµ–æ–‡ä»¶ã€‚"
  }
}