---
inclusion: always
---
<!------------------------------------------------------------------------------------
   Add rules to this file or a short description that will apply across all your workspaces.
   
   Learn about inclusion modes: https://kiro.dev/docs/steering/#inclusion-modes
-------------------------------------------------------------------------------------> 

# AI ç¼–ç æ—¥å¿—ä»£ç ç”ŸæˆåŸåˆ™ v1 (LLM æŒ‡ä»¤é›†)

## ğŸ¯ æ ¸å¿ƒåŸåˆ™ (7æ¡é“å¾‹)

AI ç”Ÿæˆæ—¥å¿—ä»£ç æ—¶å¿…é¡»éµå¾ªçš„æ ¸å¿ƒåŸåˆ™ï¼š

| ç¼–å· | åŸåˆ™ | æè¿° | å…³é”®è¦ç‚¹ |
| :--- | :--- | :--- | :--- |
| **R1** | **ç»“æ„åŒ–æ ¼å¼** | å¿…é¡»ä½¿ç”¨ JSON/é”®å€¼å¯¹ï¼Œç¦æ­¢çº¯æ–‡æœ¬ | ä¾¿äºè‡ªåŠ¨åŒ–è§£æå’Œåˆ†æ |
| **R2** | **æ ‡å‡†æ—¥å¿—åº“** | ä½¿ç”¨è¯­è¨€æ¨èçš„ç°ä»£æ—¥å¿—åº“ | Python: structlog/logging, Go: zap, Node: pino, Java: slf4j |
| **R3** | **æ­£ç¡®çº§åˆ«** | ä¸¥æ ¼æŒ‰è¯­ä¹‰ä½¿ç”¨æ—¥å¿—çº§åˆ« | INFO=æ­£å¸¸æµç¨‹, WARN=æ½œåœ¨é—®é¢˜, ERROR=æ“ä½œå¤±è´¥ |
| **R4** | **æ€§èƒ½ä¼˜å…ˆ** | é¿å…æ€§èƒ½é™·é˜± | ç¦æ­¢åœ¨ INFO/WARN ä½¿ç”¨åŠ¨æ€åå°„ï¼Œé«˜é¢‘åœºæ™¯ç”¨å¼‚æ­¥ |
| **R5** | **å®Œæ•´ä¸Šä¸‹æ–‡** | ERROR å¿…é¡»åŒ…å«å®Œæ•´æ’æŸ¥ä¿¡æ¯ | æ“ä½œå + ä¸šåŠ¡æ ‡è¯†ç¬¦ + å¼‚å¸¸å †æ ˆ |
| **R6** | **æ™ºèƒ½æµæ§** | é«˜é¢‘æ—¥å¿—ä¼˜å…ˆèšåˆå’Œé™é€Ÿ | èšåˆ > é™é€Ÿ > æ™ºèƒ½é‡‡æ · > ç®€å•é‡‡æ ·ï¼Œå…³é”®è·¯å¾„ä¸é‡‡æ · |
| **R7** | **æŒ‡æ ‡åˆ†ç¦»** | åŒºåˆ†æ—¥å¿—å’ŒæŒ‡æ ‡ | è€—æ—¶ã€è®¡æ•°ç­‰æŒ‡æ ‡ç”¨ä¸“ç”¨ç³»ç»Ÿ(Prometheus/StatsD)ï¼Œéæ—¥å¿— |

## ğŸ“‹ æ—¥å¿—çº§åˆ«å†³ç­–

### å¿«é€Ÿå†³ç­–è§„åˆ™

```
äº‹ä»¶æ€§è´¨åˆ¤æ–­ï¼š
â”œâ”€ æ­£å¸¸ä¸šåŠ¡æµç¨‹ â†’ INFO
â”‚   â””â”€ ç¤ºä¾‹ï¼šç”¨æˆ·ç™»å½•æˆåŠŸã€è®¢å•åˆ›å»ºã€API è°ƒç”¨å®Œæˆ
â”‚
â”œâ”€ æ½œåœ¨é—®é¢˜/å¯æ¢å¤é”™è¯¯ â†’ WARN  
â”‚   â””â”€ ç¤ºä¾‹ï¼šé‡è¯•æˆåŠŸã€é™çº§å¤„ç†ã€é…ç½®ç¼ºå¤±ä½¿ç”¨é»˜è®¤å€¼
â”‚
â””â”€ æ“ä½œå¤±è´¥/ä¸å¯æ¢å¤ â†’ ERROR
    â””â”€ ç¤ºä¾‹ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ã€ä¸šåŠ¡é€»è¾‘å¼‚å¸¸ã€å¤–éƒ¨æœåŠ¡è¶…æ—¶
```

### çº§åˆ«ä½¿ç”¨è§„èŒƒ

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ | å¿…éœ€å­—æ®µ | ç¦æ­¢åœºæ™¯ |
| :--- | :--- | :--- | :--- |
| **INFO** | å…³é”®ä¸šåŠ¡èŠ‚ç‚¹ã€æ­£å¸¸æµç¨‹ | message, ä¸šåŠ¡æ ‡è¯†ç¬¦ | è°ƒè¯•ä¿¡æ¯ã€å¾ªç¯å†…é«˜é¢‘æ—¥å¿— |
| **WARN** | å¯æ¢å¤é”™è¯¯ã€é™çº§å¤„ç† | message, åŸå› , å½±å“èŒƒå›´ | æ­£å¸¸æµç¨‹ã€ä¸å¯æ¢å¤é”™è¯¯ |
| **ERROR** | æ“ä½œå¤±è´¥ã€å¼‚å¸¸æƒ…å†µ | message, ä¸šåŠ¡æ ‡è¯†ç¬¦, å¼‚å¸¸å †æ ˆ | æ­£å¸¸æµç¨‹ã€å¯æ¢å¤çš„é—®é¢˜ |

## ğŸ”‘ å¿…éœ€å­—æ®µè§„èŒƒ

### æ‰€æœ‰æ—¥å¿—å¿…é¡»åŒ…å« (åˆ†å¸ƒå¼è¿½è¸ªæ ¸å¿ƒ)

| å­—æ®µ | è¯´æ˜ | å®ç°æ–¹å¼ |
| :--- | :--- | :--- |
| `timestamp` | ISO 8601 æ ¼å¼æ—¶é—´æˆ³ | æ—¥å¿—åº“è‡ªåŠ¨æ·»åŠ  |
| `level` | æ—¥å¿—çº§åˆ« | è°ƒç”¨æ–¹æ³•å†³å®š (info/warn/error) |
| `message` | ç®€çŸ­æè¿° (â‰¤100å­—ç¬¦) | æè¿°äº‹ä»¶è€Œéæ•°æ® |
| `service` | æœåŠ¡/åº”ç”¨åç§° | ç¯å¢ƒå˜é‡æˆ–é…ç½®æ³¨å…¥ |
| **`request_id`** | **è¯·æ±‚çš„å”¯ä¸€æ ‡è¯†ç¬¦ (Trace ID)** | **åœ¨è¯·æ±‚å…¥å£ç”Ÿæˆï¼Œå¹¶è‡ªåŠ¨æˆ–æ‰‹åŠ¨æ³¨å…¥** |

### æ ¹æ®åœºæ™¯æ·»åŠ 

| åœºæ™¯ | é¢å¤–å¿…éœ€å­—æ®µ | ç¤ºä¾‹ |
| :--- | :--- | :--- |
| **API è¯·æ±‚** | method, endpoint, status_code, duration_ms | `{"method": "POST", "endpoint": "/api/users", "status_code": 200}` |
| **æ•°æ®åº“æ“ä½œ** | operation, table, duration_ms | `{"operation": "SELECT", "table": "users", "duration_ms": 45.2}` |
| **ä¸šåŠ¡æ“ä½œ** | operation, entity_id, user_id | `{"operation": "create_order", "entity_id": "ORD123", "user_id": "U456"}` |
| **é”™è¯¯å¤„ç†** | error_type, å¼‚å¸¸å †æ ˆ | `{"error_type": "DatabaseError", "exc_info": true}` |

## ğŸ”’ å®‰å…¨åŸåˆ™

### ä¸¥æ ¼ç¦æ­¢è®°å½•

| ç±»å‹ | ç¤ºä¾‹ | åŸå›  |
| :--- | :--- | :--- |
| **è®¤è¯å‡­æ®** | å¯†ç ã€API å¯†é’¥ã€Token | å®‰å…¨é£é™© |
| **é«˜æ•æ„Ÿ PII** | èº«ä»½è¯å·ã€ä¿¡ç”¨å¡å·ã€å®Œæ•´æ‰‹æœºå· | éšç§åˆè§„ |

### å¿…é¡»è„±æ•è®°å½•

| ç±»å‹ | åŸå§‹æ•°æ® | è„±æ•å |
| :--- | :--- | :--- |
| **é‚®ç®±** | `user@example.com` | `u***@example.com` |
| **æ‰‹æœºå·** | `13812345678` | `138****5678` |
| **IP åœ°å€** | `192.168.1.100` | `192.168.*.*` |

### å¯æ˜æ–‡è®°å½•

| ç±»å‹ | ç¤ºä¾‹ |
| :--- | :--- |
| **ä¸šåŠ¡æ ‡è¯†ç¬¦** | ç”¨æˆ·IDã€è®¢å•å·ã€ä¼šè¯ID |
| **ç³»ç»Ÿæ ‡è¯†ç¬¦** | äº‹åŠ¡ID |

## âš¡ æ€§èƒ½è¦ç‚¹

### å¿…é¡»é¿å…çš„æ€§èƒ½é™·é˜±

| é™·é˜± | è¯´æ˜ | æ€§èƒ½å½±å“ | æ­£ç¡®åšæ³• |
| :--- | :--- | :--- | :--- |
| **åŠ¨æ€åå°„** | åœ¨ INFO/WARN ä½¿ç”¨ `inspect.stack()` ç­‰ | 10-100x æ€§èƒ½æŸå¤± | é™æ€é…ç½®æ¨¡å—åæˆ–ä»…åœ¨ ERROR ä½¿ç”¨ |
| **å­—ç¬¦ä¸²æ‹¼æ¥** | `"User " + str(id) + " action"` | é¢å¤–å†…å­˜åˆ†é…å’Œåºåˆ—åŒ– | ä½¿ç”¨ç»“æ„åŒ–å­—æ®µ `{"user_id": id}` |
| **åŒæ­¥å†™å…¥** | é«˜å¹¶å‘åœºæ™¯åŒæ­¥å†™æ—¥å¿— | é˜»å¡è¯·æ±‚å¤„ç† | ä½¿ç”¨å¼‚æ­¥æ—¥å¿—æˆ–ç¼“å†² |
| **è¿‡åº¦æ—¥å¿—** | å¾ªç¯å†…ã€é«˜é¢‘è°ƒç”¨å¤„æ‰“æ—¥å¿— | å­˜å‚¨å’Œæ€§èƒ½åŒé‡å‹åŠ› | èšåˆæˆ–é‡‡æ · |

### é«˜é¢‘æ—¥å¿—å¤„ç†ç­–ç•¥

| ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | ä¼˜å…ˆçº§ |
| :--- | :--- | :--- |
| **æ—¥å¿—èšåˆ** | é‡å¤æ€§é«˜çš„æ—¥å¿—ï¼ˆå¥åº·æ£€æŸ¥ã€å¿ƒè·³ï¼‰ | â­â­â­â­â­ |
| **é€Ÿç‡é™åˆ¶** | åŒç±»å‹æ—¥å¿—çŸ­æ—¶é—´å¤§é‡å‡ºç° | â­â­â­â­ |
| **æ™ºèƒ½é‡‡æ ·** | æ­£å¸¸æµç¨‹æ—¥å¿—ï¼Œä¿ç•™å¼‚å¸¸å’Œæ…¢è¯·æ±‚ | â­â­â­ |
| **ç®€å•é‡‡æ ·** | ä»…ä½œä¸ºæœ€åæ‰‹æ®µï¼Œå…³é”®è·¯å¾„ä¸é‡‡æ · | â­ |

## ğŸ¤– AI ä»£ç ç”Ÿæˆæ£€æŸ¥æ¸…å•

AI å·¥å…·ç”Ÿæˆæ—¥å¿—ä»£ç æ—¶ï¼Œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

### 1. åœºæ™¯è¯†åˆ«
- [ ] ç¡®å®šæ—¥å¿—ç±»å‹ï¼šAPI è¯·æ±‚ / ä¸šåŠ¡æ“ä½œ / æ•°æ®åº“æ“ä½œ / é”™è¯¯å¤„ç†
- [ ] è¯†åˆ«æ˜¯å¦ä¸ºé«˜é¢‘åœºæ™¯ï¼ˆ>100æ¬¡/ç§’ï¼‰

### 2. çº§åˆ«é€‰æ‹©
- [ ] æ ¹æ®äº‹ä»¶æ€§è´¨é€‰æ‹©æ­£ç¡®çº§åˆ«
- [ ] ç¡®è®¤ä¸å­˜åœ¨çº§åˆ«è¯¯ç”¨ï¼ˆå¦‚ ERROR è®°å½•æˆåŠŸäº‹ä»¶ï¼‰

### 3. ç»“æ„åŒ–éªŒè¯
- [ ] ä½¿ç”¨é”®å€¼å¯¹æ ¼å¼ï¼Œéå­—ç¬¦ä¸²æ‹¼æ¥
- [ ] åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µï¼ˆtimestamp, level, message, service, request_idï¼‰
- [ ] æ ¹æ®åœºæ™¯æ·»åŠ é¢å¤–å¿…éœ€å­—æ®µ

### 4. å®‰å…¨æ£€æŸ¥
- [ ] ä¸åŒ…å«å¯†ç ã€å¯†é’¥ã€Token
- [ ] æ•æ„Ÿ PII å·²è„±æ•
- [ ] ä¸šåŠ¡æ ‡è¯†ç¬¦å¯æ˜æ–‡è®°å½•

### 5. æ€§èƒ½æ£€æŸ¥
- [ ] æœªä½¿ç”¨åŠ¨æ€åå°„ï¼ˆINFO/WARN çº§åˆ«ï¼‰
- [ ] æœªä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥
- [ ] é«˜é¢‘åœºæ™¯å·²è€ƒè™‘èšåˆ/é‡‡æ ·
- [ ] ERROR çº§åˆ«åŒ…å«å®Œæ•´å¼‚å¸¸å †æ ˆ

### 6. åº“é€‚é…
- [ ] ä½¿ç”¨ç›®æ ‡è¯­è¨€çš„æ¨èæ—¥å¿—åº“
- [ ] æ­£ç¡®è°ƒç”¨åº“çš„ APIï¼ˆå¦‚ Python çš„ `exc_info=True`ï¼‰

## âŒ å¸¸è§é”™è¯¯æ¨¡å¼

| é”™è¯¯æ¨¡å¼ | é”™è¯¯ç¤ºä¾‹ | æ­£ç¡®åšæ³• |
| :--- | :--- | :--- |
| **çº¯æ–‡æœ¬æ—¥å¿—** | `logger.info("User 123 logged in")` | `logger.info("User login", user_id=123)` |
| **ç¼ºå°‘ä¸Šä¸‹æ–‡** | `logger.error("Failed")` | `logger.error("DB query failed", table="users", query="...", exc_info=True)` |
| **æ•æ„Ÿä¿¡æ¯** | `logger.info(f"Password: {pwd}")` | `logger.info("Auth attempt", user_id=uid)` |
| **çº§åˆ«è¯¯ç”¨** | `logger.error("Login success")` | `logger.info("Login success", user_id=123)` |
| **æ€§èƒ½é™·é˜±** | `logger.info("Call", caller=inspect.stack())` | `logger.info("Call", function="process_user")` |
| **å­—ç¬¦ä¸²æ‹¼æ¥** | `logger.info("User " + str(id))` | `logger.info("User action", user_id=id)` |

## ğŸ“ ä»£ç æ¨¡æ¿å‚è€ƒ

### Python (structlog)

```python
# é…ç½®ï¼ˆåº”ç”¨å¯åŠ¨æ—¶ï¼‰
import structlog
import logging
import sys

# ç¡®ä¿æ ‡å‡†åº“çš„æ—¥å¿—äº‹ä»¶ä¹Ÿèƒ½è¢« structlog æ•è·
logging.basicConfig(format="%(message)s", stream=sys.stdout, level=logging.INFO)

structlog.configure(
    processors=[
        structlog.stdlib.add_log_level,
        structlog.processors.TimeStamper(fmt="iso"),
        structlog.processors.JSONRenderer()
    ],
    # ä¼˜åŒ–ç‚¹ï¼šç¡®ä¿å…¼å®¹æ ‡å‡†åº“å¹¶å®ç°é«˜æ€§èƒ½
    wrapper_class=structlog.stdlib.BoundLogger,
    logger_factory=structlog.stdlib.LoggerFactory(),
    cache_logger_on_first_use=True,
)
logger = structlog.get_logger().bind(service="user-service")

# ä½¿ç”¨
logger.info("User login", user_id=123, ip="192.168.*.*")
logger.error("DB query failed", table="users", query="SELECT...", exc_info=True)
```

### Go (zap)

```go
// é…ç½®
logger, _ := zap.NewProduction()
logger = logger.With(zap.String("service", "user-service"))

// ä½¿ç”¨
logger.Info("User login", zap.Int("user_id", 123))
logger.Error("DB query failed", zap.String("table", "users"), zap.Error(err))
```

### Node.js (pino)

```javascript
// é…ç½®
const logger = pino({ base: { service: 'user-service' } });

// ä½¿ç”¨
logger.info({ user_id: 123 }, 'User login');
logger.error({ table: 'users', error: err.message }, 'DB query failed');
```
